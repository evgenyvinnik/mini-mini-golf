<!DOCTYPE html><html lang="en"> <head> <meta charset="utf-8"/> <title>Mini mini-golf</title> <style>*{margin:0;padding:0;outline:0;user-select:none;color:#eee;text-shadow:2px 2px 1px #000;text-align:center;font-weight:900}html{font-family:"Roboto";line-height:2em;background-color:#7bb87b;overflow:hidden}#fg,#hud{left:0;top:0}.btn{margin-top:1em;margin-left:.1em;margin-right:.1em;padding:.1em .5em;display:inline-block;width:2em;height:1em;border-radius:2em;line-height:1em;border:4px solid #232;background-color:#484;font-size:5em}.btn:active{transform:scale(0.9)}.i{display:none}#ss,#rs{border-top:4px solid #9b9;background-color:#595;border-bottom:4px solid #373}#ts,#is,#ss,#rs{width:100%;z-index:1000;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%)}#bg,#fg,#hud,#ts,#is,#ss,#rs,.h{position:absolute}#is{background-color:#7bb87b}h3{font-size:5em;line-height:1.5em}h4{font-size:25em;line-height:.6em}h5{font-size:1.7em;line-height:.7em}h1{font-size:2em}h2{font-size:3em}h6{font-size:2.5em;line-height:1em}.h{width:210px;height:80px}</style> </head> <body oncontextmenu="return false;" ondragstart="return false;" ondrop="return false;" > <div id="hud" class="i"> <div id="hd" class="h"> <h1>Hole</h1> <h2 id="ht">1</h2> </div><div id="pd" class="h"> <h1>Putts</h1> <h2 id="pt">0</h2> </div><div id="td" class="h"> <h1>Total</h1> <h2 id="tt">0</h2> </div><div id="ad" class="h"> <h1>Average</h1> <h2 id="at">0</h2> </div></div><div id="ts" class="i"> <h3>Mini Mini Golf</h3> <div id="tsb"></div></div><div id="is" class="i"> <h3>Instructions</h3> <br/> <h6> Hold and move the left mouse button to aim,<br/> a longer line means more putt power.<br/><br/> Release left mouse button to putt.<br/><br/> Press space key to cancel aiming,<br/><br/> avoid sand and water traps.<br/><br/> hold the shift key to show your statistics.<br/><br/> Press the tilde key to display these instructions.<br/><br/> Press the backspace key to access the reset menu. </h6> <div id="isb"></div></div><div id="rs" class="i"> <h3>Reset?</h3> <br/> <h6> You are about to reset the entire game.<br/> This means all of your stats will be lost.<br/><br/> Are you sure you want to do this?<br/> </h6> <div id="rsb"></div><br/> <br/> </div><div id="ss" class="i"> <h3>Statistics</h3> <h6 id="s0"></h6> <br/> <h6 id="s1"></h6> <h6 id="s2"></h6> <h6 id="s3"></h6> <br/> <h6 id="s4"></h6> <br/> <h6 id="s5"></h6> <h6 id="s6"></h6> <h6 id="s7"></h6> <br/> <h6 id="s8"></h6> <h6 id="s9"></h6> <br/> <br/> </div></body> <script>const launchTime=Date.now(),D=document,W=window,STORAGE=W.localStorage,SAVEFILE_NAME="io.github.evgenyvinnik",M=Math,PI=M.PI,PI2=2*M.PI,sin=M.sin,cos=M.cos,imul=M.imul,atan2=M.atan2,ceil=M.ceil,floor=M.floor,hypot=M.hypot,min=M.min,abs=M.abs,P_N=1,P_S=4,P_E=2,P_W=8,MIN_PUTTER_LENGTH=25,M_P_L=400,M_B_S=700,HOLE_RADIUS=12,WATER_HAZZARD=0,S_H=1,W_T=8,B_T=4;M_N=0,MODE_TITLE=1,MODE_INSTRUCTIONS=2,MODE_PLAY=3,MODE_FADE_OUT=4,MODE_FADE_IN=5,oneCell=160,halfCell=80,canvasWidth=5*oneCell+4,canvasHeight=5*oneCell+4;let stats,title,titleButtons,hudScreen,rS,rSButtons,iS,iSButtons,instructionsVisible,dontResetOnInstructionsClosed,thisFrame,lastFrame,DT,BG_CANVAS,BG_CTX,OBJ_CANVAS,OBJ_CTX,FG_CANVAS,FG_CTX,data,gameState,fadeInOutCounter,ballResetX,ballResetY,ballInSand,friction,ballResetPosition,obstacle,puttAngle,putterLength,mouseDownPosition,mouseMovePosition,mouseUpPosition,pathLength,path,nodes,node,tempVar,statsVisible,secondCounter,statUpdateRequired,gameMode=MODE_TITLE,ball=null,goal={C:null,B:12},hazzards=[],putterEnabled=!1,generatorParameters={width:0,height:0,maxPathLength:0,generateExtraNodes:!0,chanceToGenerateExtraNode:1,maxExtraNodes:0,chanceToGenerateObstacle:.35,chanceToGenerateWindmill:.35},getByID=e=>document.getElementById(e),appendToDocumentBody=e=>D.body.appendChild(e),setOpacity=e=>D.body.style.opacity=`${e}`,showElement=(e,t)=>t?e.classList.remove("i"):e.classList.add("i"),setTextByID=(e,t)=>getByID(e).innerHTML=t,clamp=(e,t,a)=>e<t?t:e>a?a:e,setMode=e=>{gameMode=e},newButton=(e,t)=>{let a=D.createElement("a");return a.classList.add("btn"),a.innerHTML=e,a.onclick=t,a},newCanvas=(e,t,a)=>{let l=D.createElement("canvas"),o=l.getContext("2d");return l.ctx=o,l.width=e,l.height=t,l.id=a,appendToDocumentBody(l),l},rng={setSeed:e=>{rng.seed=e},getSeed:()=>rng.seed,random:()=>{rng.seed+=1831565813;let e=rng.seed;return e=imul(e^e>>>15,1|e),e^=e+imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296}},random=()=>rng.random(),getRandomIntInclusive=(e,t)=>(e=ceil(e),floor(random()*(floor(t)-e+1)+e)),Vec2=(e,t)=>({x:e,y:t}),length=e=>dot(e,e)**.5,add=(e,t)=>Vec2(e.x+t.x,e.y+t.y),subtract=(e,t)=>add(e,scale(t,-1)),scale=(e,t)=>Vec2(e.x*t,e.y*t),dot=(e,t)=>e.x*t.x+e.y*t.y,cross=(e,t)=>e.x*t.y-e.y*t.x,rotate=(e,t,a,l=e.x-t.x,o=e.y-t.y)=>Vec2(l*cos(a)-o*sin(a)+t.x,l*sin(a)+o*cos(a)+t.y),normalize=e=>scale(e,1/(length(e)||1)),distance=(e,t)=>length(subtract(e,t)),objects=[],collisionInfo={},setInfo=(e,t,a,l)=>{e.D=t,e.N=a,e.S=l,e.E=add(l,scale(a,t))},RigidShape=(e,t,a,l,o,n,s,r,i)=>(i={T:o,C:e,F:a,R:l,M:t?1/t:0,V:Vec2(0,0),A:Vec2(0,0),G:0,v:0,a:0,B:n,W:s,H:r,I:o?(hypot(s,r),t>0?1/(t*(s**2+r**2)/12):0):t>0?t*n**2/12:0,N:[],X:[Vec2(e.x-s/2,e.y-r/2),Vec2(e.x+s/2,e.y-r/2),Vec2(e.x+s/2,e.y+r/2),Vec2(e.x-s/2,e.y+r/2)]},o&&computeRectNormals(i),objects.push(i),i),moveShape=(e,t,a)=>{e.C=add(e.C,t)},rotateShape=(e,t,a)=>{if(e.G+=t,e.T){for(a=4;a--;)e.X[a]=rotate(e.X[a],e.C,t);computeRectNormals(e)}},boundTest=(e,t)=>length(subtract(t.C,e.C))<=e.B+t.B,computeRectNormals=(e,t)=>{for(t=4;t--;)e.N[t]=normalize(subtract(e.X[(t+1)%4],e.X[(t+2)%4]))},testCollision=(e,t,a)=>{if(!e.T&&t.T&&([e,t]=[t,e]),e.T&&!t.T){var l,o,n,s,r,i,d=1,c=-1e9,h=0;for(l=4;l--;){if(n=t.C,o=subtract(n,e.X[l]),(s=dot(o,e.N[l]))>0){c=s,h=l,d=0;break}s>c&&(c=s,h=l)}if(d)setInfo(collisionInfo,t.B-c,e.N[h],subtract(n,scale(e.N[h],t.B)));else{var m=subtract(n,e.X[h]),g=subtract(e.X[(h+1)%4],e.X[h]),u=dot(m,g);if(u<0){if((r=length(m))>t.B)return;i=normalize(m),setInfo(collisionInfo,t.B-r,i,add(n,scale(i,-t.B)))}else if(m=subtract(n,e.X[(h+1)%4]),g=scale(g,-1),(u=dot(m,g))<0){if((r=length(m))>t.B)return;i=normalize(m),setInfo(collisionInfo,t.B-r,i,add(n,scale(i,-t.B)))}else{if(!(c<t.B))return;setInfo(collisionInfo,t.B-c,e.N[h],subtract(n,scale(e.N[h],t.B)))}}return 1}},resolveCollision=(e,t,a)=>{if(e.M||t.M){var l=a.D/(e.M+t.M)*.8,o=scale(a.N,l),n=a.N;moveShape(e,scale(o,-e.M)),moveShape(t,scale(o,t.M));var s=scale(a.S,t.M/(e.M+t.M)),r=scale(a.E,e.M/(e.M+t.M)),i=add(s,r),d=subtract(i,e.C),c=subtract(i,t.C),h=add(e.V,Vec2(-1*e.v*d.y,e.v*d.x)),m=add(t.V,Vec2(-1*t.v*c.y,t.v*c.x)),g=subtract(m,h),u=dot(g,n);if(!(u>0)){var p=min(e.R,t.R),b=min(e.F,t.F),C=cross(d,n),f=cross(c,n),S=-(1+p)*u/(e.M+t.M+C*C*e.I+f*f*t.I),T=scale(n,S);e.V=subtract(e.V,scale(T,e.M)),t.V=add(t.V,scale(T,t.M)),e.v-=C*S*e.I,t.v+=f*S*t.I;var E=scale(normalize(subtract(g,scale(n,dot(g,n)))),-1),I=cross(d,E),P=cross(c,E),D=-(1+p)*dot(g,E)*b/(e.M+t.M+I*I*e.I+P*P*t.I);D>S&&(D=S),T=scale(E,D),e.V=subtract(e.V,scale(T,e.M)),t.V=add(t.V,scale(T,t.M)),e.v-=I*D*e.I,t.v+=P*D*t.I}}},Circle=(e,t,a,l,o,n=0)=>RigidShape(e,a,l,o,0,t,n),Rectangle=(e,t,a,l,o,n)=>RigidShape(e,l,o,n,1,hypot(t,a)/2,t,a),checkResolveObjectCollisions=()=>{for(i=objects.length;i--;)if(objects[i]!=ball){let e=objects[i];if(boundTest(e,ball)&&testCollision(e,ball,collisionInfo))return dot(collisionInfo.N,subtract(ball.C,e.C))<0&&(collisionInfo={D:collisionInfo.D,N:scale(collisionInfo.N,-1),S:collisionInfo.E,E:collisionInfo.S}),resolveCollision(e,ball,collisionInfo),ball.inGoal||(e.isWindmill?(gameState.flips++,statUpdateRequired=!0):e.isBlocker?(gameState.bumps++,statUpdateRequired=!0):(gameState.rebounds++,statUpdateRequired=!0)),void(mouseDownPosition&&(erasePutter(),mouseDownPosition=null,mouseMovePosition=null,putterEnabled=!1))}},nextHole=()=>{gameState.hole++,gameState.putts=0,generateHole(),updateHUD(),fadeInOutCounter=0,setMode(MODE_FADE_IN)},generateHole=()=>{gameState.seed=rng.getSeed();let e=3;generatorParameters.maxPathLength=4,generatorParameters.chanceToGenerateExtraNode=.3,generatorParameters.chanceToGenerateObstacle=.3,generatorParameters.chanceToGenerateWindmill=.25,gameState.hole<4&&(generatorParameters.chanceToGenerateObstacle=.1),gameState.hole>5&&(e++,generatorParameters.maxPathLength=6,generatorParameters.chanceToGenerateExtraNode=.45,generatorParameters.chanceToGenerateObstacle=.4,generatorParameters.chanceToGenerateWindmill=.3),gameState.hole>10&&(generatorParameters.maxPathLength=8,generatorParameters.chanceToGenerateExtraNode=.6,generatorParameters.chanceToGenerateObstacle=.5,generatorParameters.chanceToGenerateWindmill=.35),gameState.hole>15&&(e++,generatorParameters.maxPathLength=10,generatorParameters.chanceToGenerateExtraNode=.75,generatorParameters.chanceToGenerateObstacle=.6,generatorParameters.chanceToGenerateWindmill=.4),generatorParameters.width=getRandomIntInclusive(3,e),generatorParameters.height=getRandomIntInclusive(3,e),hazzards=[],objects=[],generateMainPathNodes(generatorParameters),generateExtraPathNodes(generatorParameters),getBounds(),trim(),finalizeAndDrawHole()},openNodeWall=(e,t)=>e.bitMask|=t,includeNodeInPath=e=>e.partOfPath=!0,newPath=e=>{nodes=[];for(let t=0;t<e.height;t++){let a=[];for(let l=0;l<e.width;l++)a.push({bitMask:0,row:t,col:l});nodes.push(a)}return{width:e.width,height:e.height,leftEdge:0,rightEdge:0,topEdge:0,bottomEdge:0,pathNodes:nodes}},generateMainPathNodes=e=>{const t=e.maxPathLength-1,a=e.width-1,l=e.height-1;let o=()=>{d<l?(includeNodeInPath(node),openNodeWall(node,4),d++,r(),openNodeWall(node,1),pathLength++,s()):n()},n=()=>{includeNodeInPath(node),random()<.5?(tempVar=path.firstNode,tempVar.isFirstNode=!1,tempVar.isLastNode=!0,path.lastNode=tempVar,path.firstNode=node,node.isFirstNode=!0):(node.isLastNode=!0,path.lastNode=node),c=!0},s=()=>{movingEast=i!==a&&(0===i||random()<.5)},r=()=>{node=nodes[d][i]},i=getRandomIntInclusive(0,a),d=0,c=!1;for(path=newPath(generatorParameters),pathLength=0,nodes=path.pathNodes,r(),node.isFirstNode=!0,path.firstNode=node,includeNodeInPath(node),s();!c;)movingEast?random()<.7&&i<a&&i<a?(includeNodeInPath(node),openNodeWall(node,2),i++,r(),openNodeWall(node,8),pathLength++):o():random()<.7&&i>0&&i>0?(includeNodeInPath(node),openNodeWall(node,8),i--,r(),openNodeWall(node,2),pathLength++):o(),-1!=t&&pathLength>=t&&n()},getBounds=()=>{const e=path.pathNodes;(()=>{for(let t=0;t<path.width;t++)for(let a=0;a<path.height;a++)if(e[a][t].partOfPath)return void(path.leftEdge=t);path.leftEdge=0})(),(()=>{for(let t=path.width-1;t>0;t--)for(let a=0;a<path.height;a++)if(e[a][t].partOfPath)return void(path.rightEdge=t);path.rightEdge=path.width-1})();for(let t=path.height-1;t>0;t--)for(let a=0;a<path.width;a++)if(e[t][a].partOfPath)return void(path.bottomEdge=t);path.bottomEdge=path.height-1},trim=()=>{let e=[];for(let t=0;t<=path.bottomEdge;t++){let a=[];for(let e=path.leftEdge;e<=path.rightEdge;e++)a.push(path.pathNodes[t][e]);e.push(a)}path.width=path.rightEdge-path.leftEdge+1,path.height=path.bottomEdge+1,path.pathNodes=e},generateExtraPathNodes=e=>{if(e.generateExtraNodes){let t=[],a=[],l=(e,t)=>{e.potentialExtra||e.partOfPath||(e.potentialExtra=!0,e.extraDirection=t,a.push(e))};const o=e.width-1,n=e.height-1,s=path.pathNodes;for(let e=0;e<s.length;e++){const t=s[e];for(let a=0;a<t.length;a++)t[a].partOfPath&&(a>0&&l(t[a-1],2),a<o&&l(t[a+1],8),e>0&&l(s[e-1][a],4),e<n&&l(s[e+1][a],1))}for(let e=a.length-1;e>=0;e--)t.push(a.splice(floor(random()*e),1)[0]);let r=clamp(t.length,0,t.length);for(let a=0;a<r;a++)if(random()<=e.chanceToGenerateExtraNode){let e=t.shift(),a=e.row,l=e.col,r=!0,i=(e,t)=>{s[e][t].extra&&(r=!1)};if(l>0&&i(a,l-1),l<o&&i(a,l+1),a>0&&i(a-1,l),a<n&&i(a+1,l),r)switch(e.extra=!0,e.partOfPath=!0,e.extraDirection){case 1:openNodeWall(s[e.row-1][e.col],4),openNodeWall(e,1);break;case 4:openNodeWall(s[e.row+1][e.col],1),openNodeWall(e,4);break;case 2:openNodeWall(s[e.row][e.col+1],8),openNodeWall(e,2);break;default:openNodeWall(s[e.row][e.col-1],2),openNodeWall(e,8)}e.potentialExtra=!1}}},finalizeAndDrawHole=()=>{nodes=path.pathNodes;let e,t,a,l=1,o=(e,t,a,l)=>BG_CTX.clearRect(e,t,a,l),n=e=>BG_CTX.fillStyle=`#${e}`,s=(e,t,a,l)=>BG_CTX.fillRect(e,t,a,l),r=(e,l)=>{n(e),s(t,a,oneCell,oneCell),n(l),s(t+1,a+1,halfCell-2,halfCell-2),s(t+1,a+halfCell+1,halfCell-2,halfCell-2),s(t+halfCell+1,a+1,halfCell-2,halfCell-2),s(t+halfCell+1,a+halfCell+1,halfCell-2,halfCell-2)},i=(e,l,o)=>{r(l,o),hazzards.push({bitMask:node.bitMask,type:e,x:t,y:a})};o(0,0,canvasWidth,canvasHeight);for(let d=0;d<nodes.length;d++){e=nodes[d];for(let c=0;c<e.length;c++)if(node=e[c],node.x=c*oneCell+(5-path.width)*halfCell,node.y=d*oneCell+(5-path.height)*halfCell,node.partOfPath){t=node.x,a=node.y,oneCell,path.height,halfCell,node.extra?random()<.5?i(0,"48c","69c"):i(1,"a95","ba6"):(r("595","6a6"),node.isFirstNode?(ball=Circle(Vec2(t+halfCell,a+halfCell),6,1,0,1),ball.inGoal=!1,ball.draw=!0):node.isLastNode?(goal.C=Vec2(t+halfCell,a+halfCell),BG_CTX.beginPath(),BG_CTX.arc(goal.C.x,goal.C.y,12,0,7),n("6a6"),BG_CTX.fill(),BG_CTX.stroke()):random()<generatorParameters.chanceToGenerateObstacle&&(random()<generatorParameters.chanceToGenerateWindmill?(obstacle=Rectangle(Vec2(t+halfCell,a+halfCell),100,8,0,1,1),random()<.5?obstacle.v=1.5:obstacle.v=-1.5,obstacle.isWindmill=!0,obstacle.id=l++,obstacle.draw=!0):(obstacle=Rectangle(Vec2(t+halfCell,a+halfCell),25,25,0,1,1),rotateShape(obstacle,.25*PI),obstacle.isBlocker=!0,obstacle.draw=!0))),n("232");let e=(e=0)=>{Rectangle(Vec2(t+e,a+halfCell),8,oneCell+4,0,1,1),s(t-2+e,a-1,4,oneCell+1)},d=(e=0)=>{Rectangle(Vec2(t+oneCell+e,a+halfCell-1),8,oneCell+2,0,1,1),s(t+oneCell+e-4,a-1,4,oneCell+1)},c=(e=0)=>{Rectangle(Vec2(t+halfCell,a+2+e),oneCell,8,0,1,1),s(t-2,a-2+e,oneCell,4)},h=(e=0)=>{Rectangle(Vec2(t+halfCell,a+oneCell+e+2),oneCell,8,0,1,1),s(t-2,a-2+oneCell+e,oneCell+2,4)};switch(node.bitMask){case 1:e(),d(),node.extra?(o(t-2,a+halfCell,oneCell+4,halfCell+1),h(-halfCell)):h();break;case 2:h(),c(),node.extra?(o(t-2,a-2,halfCell+2,oneCell+4),e(halfCell)):e();break;case 3:e(),h();break;case 4:e(),d(),node.extra?(o(t-2,a-1,oneCell+4,halfCell),c(halfCell)):c();break;case 5:e(),d();break;case 6:e(),c();break;case 7:e();break;case 8:c(),h(),node.extra?(o(t+halfCell,a-2,halfCell,oneCell+4),d(-halfCell)):d();break;case 9:d(),h();break;case 10:c(),h();break;case 11:h();break;case 12:c(),d();break;case 13:d();break;case 14:c()}}}},repositionContent=()=>{let e=(e,t,a)=>{e.style.left=`${t}px`,e.style.top=`${a}px`},t=W.innerWidth/2-canvasWidth/2,a=W.innerHeight/2-canvasHeight/2,l=t-210,o=t+canvasWidth,n=a+canvasHeight-80;e(BG_CANVAS,t,a),e(OBJ_CANVAS,t,a),e(getByID("hd"),l,a),e(getByID("pd"),o,a),e(getByID("td"),l,n),e(getByID("ad"),o,n)},updateHUD=()=>{setTextByID("ht",gameState.hole),setTextByID("pt",gameState.putts),setTextByID("tt",gameState.total),setTextByID("at",floor(gameState.total/gameState.hole))},updateStatPage=()=>{updatePlayTime(),setTextByID("s1",`Holes in one: ${gameState.holesInOne}`),setTextByID("s2",`Holes in two: ${gameState.holesInTwo}`),setTextByID("s3",`Holes in three: ${gameState.holesInThree}`),setTextByID("s4",`Close calls: ${gameState.closeCalls}`),setTextByID("s5",`Bumps: ${gameState.bumps}`),setTextByID("s6",`Flips: ${gameState.flips}`),setTextByID("s7",`Rebounds: ${gameState.rebounds}`),setTextByID("s8",`Sand shots: ${gameState.beached}`),setTextByID("s9",`Water shots:  ${gameState.splashes}`)},loadGameState=()=>{if(tempVar=STORAGE.getItem(SAVEFILE_NAME),!tempVar)return gameState={seed:11091968,ball:null,windmills:null,hole:1,putts:0,total:0,beached:0,splashes:0,holesInOne:0,holesInTwo:0,holesInThree:0,closeCalls:0,bumps:0,flips:0,rebounds:0,playTime:0,mode:0},rng.setSeed(gameState.seed),showElement(title,!0),!1;switch(gameState=JSON.parse(tempVar),rng.setSeed(gameState.seed),gameState.mode){case MODE_TITLE:showElement(title,!0),setMode(MODE_TITLE);break;case MODE_INSTRUCTIONS:showElement(iS,!0),setMode(MODE_INSTRUCTIONS);break;default:generateHole();let e=e=>{for(let t=0;t<objects.length;t++)if(obstacle=objects[t],obstacle.isWindmill&&obstacle.id===e)return obstacle};if(gameState.windmills)for(let t=0;t<gameState.windmills.length;t++)tempVar=gameState.windmills[t],obstacle=e(tempVar.id),obstacle.v=tempVar.v,rotateShape(obstacle,tempVar.G);gameState.ball&&(objects.splice(objects.indexOf(ball),1),ball=gameState.ball,objects.push(ball),ball.inGoal?(ball.V=Vec2(0,0),setOpacity(0),setMode(M_N),nextHole()):(setOpacity(1),setMode(MODE_PLAY))),updateHUD(),showElement(hudScreen,!0),putterEnabled=!0}},saveGameState=()=>{if(objects.length>0){tempVar=[];for(let e=0;e<objects.length;e++)obstacle=objects[e],obstacle.isWindmill&&tempVar.push({id:obstacle.id,v:obstacle.v,G:obstacle.G});gameState.windmills=tempVar}gameState.ball=ball,gameState.mode=gameMode,gameState.playTime+=(Date.now()-launchTime)/1e3,STORAGE.setItem(SAVEFILE_NAME,JSON.stringify(gameState))};erasePutter=()=>{if(mouseMovePosition){let e=clamp(mouseMovePosition.x,0,W.innerWidth),t=mouseDownPosition.x-e,a=clamp(mouseMovePosition.y,0,W.innerHeight),l=mouseDownPosition.y;mouseDownPosition.x<mouseMovePosition.x&&(e=mouseDownPosition.x,t=mouseMovePosition.x-e),mouseDownPosition.y<mouseMovePosition.y&&(a=mouseDownPosition.y,l=mouseMovePosition.y-a),FG_CTX.clearRect(e-8,a-8,t+16,l+16)}},resetPutter=()=>{erasePutter(),mouseMovePosition=null,mouseDownPosition=null,putterLength=0},D.onmousedown=e=>{putterEnabled&&0===e.button&&gameMode===MODE_PLAY&&0===length(ball.V)&&(mouseDownPosition=Vec2(e.x,e.y))},D.onmousemove=e=>{if(mouseDownPosition&&putterEnabled&&gameMode===MODE_PLAY){erasePutter();let t=mouseDownPosition.x,a=mouseDownPosition.y,l=e.x,o=e.y;puttAngle=atan2(a-o,t-l);let n=atan2(o-a,l-t),s=.25*PI,r=2*s,i=8*cos(n-s),d=8*sin(n-s),c=8*cos(n+s),h=8*sin(n+s),m=6*cos(n-r),g=6*sin(n-r),u=6*cos(n+r),p=6*sin(n+r);putterLength=distance(mouseDownPosition,{x:l,y:o}),putterColor="fff",putterLength>400&&(putterLength=400),l=cos(n)*putterLength+t,o=sin(n)*putterLength+a,mouseMovePosition={x:l,y:o},FG_CTX.strokeStyle="#fff",FG_CTX.lineWidth=3,FG_CTX.beginPath();let b=(e,t)=>{FG_CTX.moveTo(e,t)},C=(e,t)=>{FG_CTX.lineTo(e,t)};b(i+t,d+a),C(t,a),C(c+t,h+a),b(t,a),C(l,o),b(m+l,g+o),C(u+l,p+o),FG_CTX.stroke()}},D.onmouseup=e=>{if(putterEnabled&&0===e.button&&mouseDownPosition&&gameMode===MODE_PLAY&&(erasePutter(),mouseMovePosition=null,mouseDownPosition=null,putterLength>=25)){putterEnabled=!1,ballResetPosition=ball.C;let e=putterLength/400;ball.V=Vec2(cos(puttAngle)*(700*e),sin(puttAngle)*(700*e)),putterLength=0,gameState.putts++,gameState.total++,updateHUD()}},D.onkeyup=e=>{if(gameMode===MODE_PLAY)switch(e.keyCode){case 32:resetPutter(),e.preventDefault();break;case 16:showElement(stats,!1),statsVisible=!1,e.preventDefault();break;case 8:resetPutter(),putterEnabled=!1,showElement(rS,!0),e.preventDefault();break;case 192:resetPutter(),showElement(iS,!0),instructionsVisible=!0,dontResetOnInstructionsClosed=!0,e.preventDefault()}},D.onkeydown=e=>{16!==e.keyCode||gameMode!==MODE_PLAY||statsVisible||(updateStatPage(),showElement(stats,!0),secondCounter=0,statsVisible=!0,e.preventDefault())},W.onresize=repositionContent,W.onbeforeunload=saveGameState,W.onload=()=>{stats=getByID("ss"),title=getByID("ts"),titleButtons=getByID("tsb"),hudScreen=getByID("hud"),rS=getByID("rs"),rSButtons=getByID("rsb"),iS=getByID("is"),iSButtons=getByID("isb"),titleButtons.appendChild(newButton("OK",(()=>{showElement(title,!1),setMode(MODE_INSTRUCTIONS),showElement(iS,!0)}))),iSButtons.appendChild(newButton("OK",(()=>{showElement(iS,!1),instructionsVisible=!1,dontResetOnInstructionsClosed||(setOpacity(0),generateHole(),showElement(hudScreen,!0),fadeInOutCounter=0,setMode(MODE_FADE_IN))}))),rSButtons.appendChild(newButton("YES",(()=>{showElement(rS,!1),W.onbeforeunload=null,STORAGE.removeItem(SAVEFILE_NAME),location.reload()}))),rSButtons.appendChild(newButton("NO",(()=>{showElement(rS,!1),putterEnabled=!0}))),BG_CANVAS=newCanvas(canvasWidth,canvasHeight,"bg"),BG_CTX=BG_CANVAS.ctx,OBJ_CANVAS=newCanvas(canvasWidth,canvasHeight,"bg"),OBJ_CTX=OBJ_CANVAS.ctx,FG_CANVAS=newCanvas(W.innerWidth,W.innerHeight,"fg"),FG_CTX=FG_CANVAS.ctx,loadGameState(),repositionContent(),lastFrame=Date.now(),onEnterFrame()};let checkResolveHazzardCollisions=()=>{let e=ball.C.x;ballResetY=ball.C.y;for(let t=0;t<hazzards.length;t++){const a=hazzards[t];if(e>a.x&&e<a.x+oneCell&&ballResetY>a.y&&ballResetY<a.y+oneCell)if(1===a.type)ball.inSand||gameState.beached++,ball.inSand=!0,friction=.75;else{switch(a.bitMask){case 1:e=a.x+halfCell,ballResetY=a.y-8;break;case 2:e=a.x+oneCell+8,ballResetY=a.y+halfCell;break;case 4:e=a.x+halfCell,ballResetY=a.y+oneCell+8;break;default:e=a.x-8,ballResetY=a.y+halfCell}ball.C=Vec2(e,ballResetY),ball.V=Vec2(0,0),putterEnabled=!0,gameState.splashes++,statUpdateRequired=!0}else ball.inSand=ballInSand}},secondsToHMS=e=>`${floor(e/3600)}h, ${floor(e%3600/60)}m, ${floor(e%3600%60)}s`,updatePlayTime=()=>setTextByID("s0",`Play time: ${secondsToHMS(gameState.playTime+(Date.now()-launchTime)/1e3)}`),onEnterFrame=()=>{for(statUpdateRequired=!1,thisFrame=Date.now(),DT=(thisFrame-lastFrame)/1e3,lastFrame=thisFrame,statsVisible&&(secondCounter+=DT,secondCounter>=1&&(secondCounter-=1,updatePlayTime())),i=objects.length;i--;){let e=objects[i];e.V=add(e.V,scale(e.A,DT)),moveShape(e,scale(e.V,DT)),e.v+=e.a*DT,rotateShape(e,e.v*DT)}switch(checkResolveObjectCollisions(),gameMode){case MODE_PLAY:let e=ball.C.x,t=ball.C.y,a=!1;if(e>0||e<canvasWidth||t>0||t<canvasHeight){nodes=path.pathNodes,node=nodes[0][0],nodes[floor((t-node.y)/oneCell)][floor((e-node.x)/oneCell)].partOfPath||(a=!0)}else a=!0;a&&(ball.C=ballResetPosition,ball.V=Vec2(0,0),gameState.putts--,statUpdateRequired=!0,putterEnabled=!0);let l=length(ball.V);if(l>0){friction=.985,checkResolveHazzardCollisions(),ball.V=scale(ball.V,friction);let e=distance(ball.C,goal.C);if(l<10&&(ball.V=Vec2(0,0),ball.inGoal?(fadeInOutCounter=1,setMode(MODE_FADE_OUT)):(e<25&&(gameState.closeCalls++,statUpdateRequired=!0),putterEnabled=!0)),!ball.inGoal&&e<=12){ball.V=scale(ball.V,.5);let e=goal.C.x,t=goal.C.y;Rectangle(Vec2(e-20,t),16,40,0,1,1),Rectangle(Vec2(e+20,t),16,40,0,1,1),Rectangle(Vec2(e,t-20),40,16,0,1,1),Rectangle(Vec2(e,t+20),40,16,0,1,1),1===gameState.putts?(gameState.holesInOne++,statUpdateRequired=!0):2==gameState.putts?(gameState.holesInTwo++,statUpdateRequired=!0):3==gameState.putts&&(gameState.holesInThree++,statUpdateRequired=!0),ball.inGoal=!0,putterEnabled=!1}else ball.inGoal&&e>25&&(ball.C=goal.C)}break;case MODE_FADE_OUT:fadeInOutCounter-=DT,fadeInOutCounter<=0&&(fadeInOutCounter=0,setMode(M_N),nextHole()),setOpacity(fadeInOutCounter);break;case MODE_FADE_IN:fadeInOutCounter+=DT,fadeInOutCounter>=1&&(fadeInOutCounter=1,setMode(MODE_PLAY),putterEnabled=!0),setOpacity(fadeInOutCounter)}for(OBJ_CTX.clearRect(0,0,canvasWidth,canvasHeight),OBJ_CTX.strokeStyle="#222",OBJ_CTX.lineJoin="bevel",i=objects.length;i--;){let e=objects[i];e.draw&&(OBJ_CTX.save(),OBJ_CTX.translate(e.C.x,e.C.y),OBJ_CTX.rotate(e.G),e.T?(OBJ_CTX.fillStyle="#aaa",OBJ_CTX.strokeRect(-e.W/2,-e.H/2,e.W,e.H),OBJ_CTX.fillRect(-e.W/2,-e.H/2,e.W,e.H)):(OBJ_CTX.fillStyle="#eee",OBJ_CTX.beginPath(),OBJ_CTX.arc(0,0,e.B,0,7),OBJ_CTX.fill(),OBJ_CTX.stroke()),OBJ_CTX.restore())}statUpdateRequired&&updateStatPage(),requestAnimationFrame(onEnterFrame)};</script></html>